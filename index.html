<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIPLOMATIC HUB</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="container">
        <h1 class="gold-text">DIPLOMATIC HUB</h1>

        <div id="connection-screen" class="screen">
            <button class="game-card" onclick="goToLobby()">๐ ูุนุจ ุฃูููุงูู</button>
            <button class="game-card" onclick="goToCategories()">๐ ูุนุจ ูุญูู</button>
        </div>

        <div id="online-lobby" class="screen hidden">
            <button class="action-btn" onclick="makeRoom()">โ ุฅูุดุงุก ุบุฑูุฉ ุฌุฏูุฏุฉ</button>
            <p style="margin:20px 0; color:#888;">ุฃู</p>
            <input type="text" id="room-input" placeholder="ุงุฏุฎู ููุฏ ุงูุบุฑูุฉ">
            <button class="game-card" onclick="enterRoom()">๐ ุฏุฎูู ุบุฑูุฉ</button>
            <button class="back-nav-btn" onclick="location.reload()">ุฑุฌูุน</button>
        </div>

        <div id="category-screen" class="screen hidden">
            <h3>ุงุฎุชุฑ ููุน ุงูุชุญุฏู</h3>
            <button class="game-card" onclick="pickGame('kora')">โฝ ุชุญุฏู ุงูููุฑุฉ</button>
            <button class="game-card" onclick="pickGame('fawazir')">๐ ููุงุฒูุฑ ุฑูุถุงู</button>
            <button class="game-card" onclick="pickGame('spy')">๐ต๏ธ ููู ุงูุฌุงุณูุณุ</button>
        </div>

        <div id="game-screen" class="screen hidden">
            <p class="gold-text" id="status-display">ุงูุชุธุฑ...</p>
            <div class="glass-box">
                <p id="question-text">ูู ุงูุชุธุงุฑ ุงุฎุชูุงุฑ ุงููุนุจุฉ...</p>
                <p id="answer-text" class="hidden" style="color:#00ff88; margin-top:15px; border-top:1px solid #333; padding-top:10px;"></p>
            </div>
            <div id="host-controls" class="hidden">
                <button class="action-btn" onclick="showMeAnswer()">ุฅุธูุงุฑ ุงูุฅุฌุงุจุฉ</button>
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <button class="action-btn" style="background:#28a745;" onclick="moveNext()">ุตุญ โ</button>
                    <button class="action-btn" style="background:#dc3545;" onclick="moveNext()">ุบูุท โ</button>
                </div>
            </div>
            <p id="waiting-msg" class="hidden">ุงูุชุธุฑ ุงููุถูู ูุฎุชุงุฑ ุงููุนุจุฉ...</p>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

    <script>
        // ุฏูุฌูุง ุงูู JS ููุง ุนุดุงู ูุถูู ุงูุงุณุชุฌุงุจุฉ
        const firebaseConfig = {
            apiKey: "AIzaSyAESCjnKsQxNX_IKH9Fm_ePpIsbb9C_NsE",
            authDomain: "diplomatic-games.firebaseapp.com",
            projectId: "diplomatic-games",
            storageBucket: "diplomatic-games.firebasestorage.app",
            messagingSenderId: "726415224604",
            appId: "1:726415224604:web:3f436ef230254a5ee914d9",
            databaseURL: "https://diplomatic-games-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let myGame = { roomId: '', isHost: false, type: '', round: 0 };
        const questions = {
            kora: [{q:"ูู ูุฏุงู ุงูุนุงููุ", a:"ุฑููุงูุฏู"}, {q:"ุจุทู 2022ุ", a:"ุงูุฃุฑุฌูุชูู"}],
            fawazir: [{q:"ููุชุจ ููุง ููุฑุฃุ", a:"ุงูููู"}],
            spy: ["ูุทุงุฑ", "ูุณุชุดูู", "ููุนุจ"]
        };

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        window.goToLobby = () => nav('online-lobby');
        window.goToCategories = () => nav('category-screen');

        window.makeRoom = () => {
            const rId = Math.random().toString(36).substring(2, 6).toUpperCase();
            myGame.roomId = rId;
            myGame.isHost = true;
            db.ref('rooms/' + rId).set({ status: 'waiting', round: 0, showAnswer: false, gameType: '' })
            .then(() => {
                alert("ููุฏ ุบุฑูุชู: " + rId);
                watchRoom(rId);
                nav('category-screen');
            });
        };

        window.enterRoom = () => {
            const rId = document.getElementById('room-input').value.toUpperCase().trim();
            db.ref('rooms/' + rId).once('value', (snap) => {
                if (snap.exists()) {
                    myGame.roomId = rId;
                    myGame.isHost = false;
                    watchRoom(rId);
                    nav('game-screen');
                } else { alert("ุงูููุฏ ุบูุท!"); }
            });
        };

        window.pickGame = (t) => {
            if (myGame.isHost) {
                db.ref('rooms/' + myGame.roomId).update({ gameType: t });
                nav('game-screen');
            } else {
                myGame.type = t;
                nav('game-screen');
                updateDisplay();
            }
        };

        function watchRoom(rId) {
            db.ref('rooms/' + rId).on('value', (snap) => {
                const v = snap.val();
                if (!v) return;
                myGame.type = v.gameType;
                myGame.round = v.round;
                
                if (myGame.isHost) {
                    document.getElementById('host-controls').classList.remove('hidden');
                    document.getElementById('waiting-msg').classList.add('hidden');
                } else {
                    document.getElementById('host-controls').classList.add('hidden');
                    document.getElementById('waiting-msg').classList.toggle('hidden', !!myGame.type);
                }

                document.getElementById('answer-text').classList.toggle('hidden', !v.showAnswer);
                if (myGame.type) updateDisplay();
            });
        }

        function updateDisplay() {
            const list = questions[myGame.type];
            const q = list[myGame.round % list.length];
            document.getElementById('question-text').innerText = q.q || q;
            document.getElementById('answer-text').innerText = "ุงูุฅุฌุงุจุฉ: " + (q.a || "ุฎูู!");
            document.getElementById('status-display').innerText = "ุฌุงุฑู ุงูุชุญุฏู...";
        }

        window.showMeAnswer = () => db.ref('rooms/' + myGame.roomId).update({ showAnswer: true });
        window.moveNext = () => db.ref('rooms/' + myGame.roomId).update({ round: myGame.round + 1, showAnswer: false });

    </script>
</body>
</html>
