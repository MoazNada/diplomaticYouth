<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIPLOMATIC HUB - FINAL ELITE</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="container">
        <h1 class="gold-text">DIPLOMATIC HUB</h1>

        <div id="category-screen" class="screen">
            <h3>ุงุฎุชุฑ ููุน ุงูุชุญุฏู</h3>
            <button class="game-card" onclick="setGame('kora')">โฝ ููุฑุฉ (20 ุณุคุงู)</button>
            <button class="game-card" onclick="setGame('fawazir')">๐ ููุงุฒูุฑ (20 ุณุคุงู)</button>
            <button class="game-card" onclick="setGame('no_repeat')">๐ซ ุจุฏูู ุชูุฑุงุฑ (20 ุณุคุงู)</button>
            <button class="game-card" onclick="setGame('what_if')">๐ค ูู ููุช ููุงูู (20 ุณุคุงู)</button>
            <div style="margin-top:20px;">
                <select id="q-count-select" class="action-btn" style="background:#222; color:white;">
                    <option value="10">10 ุฃุณุฆูุฉ</option>
                    <option value="20" selected>20 ุณุคุงู</option>
                </select>
            </div>
        </div>

        <div id="online-setup-screen" class="screen hidden">
            <input type="text" id="user-name" placeholder="ุงุณูู">
            <button class="action-btn" onclick="initRoom('create')">โ ุฅูุดุงุก ุบุฑูุฉ</button>
            <input type="text" id="join-input" placeholder="ููุฏ ุงูุบุฑูุฉ">
            <button class="game-card" onclick="initRoom('join')">๐ ุงูุถูุงู</button>
        </div>

        <div id="lobby-screen" class="screen hidden">
            <h1 id="room-display" class="gold-text"></h1>
            <div class="glass-box">
                <p>ุงูุฃุจุทุงู ุงููุชุตููู (2-10):</p>
                <div id="players-list"></div>
            </div>
            <button id="host-start-btn" class="action-btn hidden" onclick="triggerStart()" disabled style="opacity:0.5;">ุงุจุฏุฃ ุงูููุงุฌูุฉ ๐</button>
            <p id="lobby-msg" style="color: gray; font-size: 0.9rem; margin-top: 10px;">ุจุงูุชุธุงุฑ ูุงุนุจ ุขุฎุฑ ุนูู ุงูุฃูู...</p>
        </div>

        <div id="game-screen" class="screen hidden">
            <p id="q-info" style="color:var(--gold); font-weight:bold;"></p>
            <div class="glass-box"><h3 id="question-text">...</h3></div>
            <div id="input-zone">
                <input type="text" id="ans-input" placeholder="ุงูุชุจ ุฅุฌุงุจุชู ููุง...">
                <button class="action-btn" onclick="submitProcess()">ุฅุฑุณุงู โ</button>
            </div>
            <div id="waiting-msg" class="hidden">ุชู ุงุณุชูุงู ุฅุฌุงุจุชู.. ุจุงูุชุธุงุฑ ุงูุจููุฉ โณ</div>
        </div>

        <div id="result-screen" class="screen hidden">
            <h3 class="gold-text">ุงููุชุงุฆุฌ ูุงูุชุฑุชูุจ ๐</h3>
            <div id="leaderboard" class="glass-box"></div>
            <div class="glass-box" style="border: 1px solid #00ff88; margin-top:10px;">
                <p>ุงูุฅุฌุงุจุงุช ุงูุตุญูุญุฉ:</p>
                <div id="correct-reveal" style="color:#00ff88; font-size: 1.1rem; line-height: 1.6;"></div>
            </div>
            <div id="host-controls" class="hidden" style="margin-top: 20px;">
                <button class="action-btn" onclick="triggerNext()" style="background: var(--gold); color: black;">ุงูุณุคุงู ุงูุชุงูู โก๏ธ</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAESCjnKsQxNX_IKH9Fm_ePpIsbb9C_NsE",
            authDomain: "diplomatic-games.firebaseapp.com",
            projectId: "diplomatic-games",
            storageBucket: "diplomatic-games.firebasestorage.app",
            messagingSenderId: "726415224604",
            appId: "1:726415224604:web:3f436ef230254a5ee914d9",
            databaseURL: "https://diplomatic-games-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let me = { name: '', room: '', isHost: false, gameType: '', maxQ: 20, score: 0 };
        
        const dataBank = {
            kora: [
                {q:"ูู ูุฏุงู ุงูุนุงูู ุงูุชุงุฑูุฎูุ", a:["ุฑููุงูุฏู", "ูุฑูุณุชูุงูู", "ุงูุฏูู", "CR7"]},
                {q:"ูุงุฏู ุงููุฑู ูู ุฃูุฑูููุงุ", a:["ุงูุงููู", "ุงููุงุฏู ุงูุงููู", "ุงูุดูุงุทูู ุงูุญูุฑ"]},
                {q:"ุจุทู ูููุฏูุงู 2022ุ", a:["ุงูุงุฑุฌูุชูู", "ููุณู"]},
                {q:"ูุฏุฑุจ ูุงูุดุณุชุฑ ุณูุชูุ", a:["ุบูุงุฑุฏูููุง", "ุจูุจ", "ุฌูุงุฑุฏูููุง"]},
                {q:"ุฃูู ููุนุจ ูุญูุฏ ุตูุงุญุ", a:["ูููุฑุจูู", "ูููุฑ"]},
                {q:"ูููุจ ุจุงูุจุฑุบูุซุ", a:["ููุณู", "ูููููู"]},
                {q:"ุจุทู ููุฑู 2024ุ", a:["ุงุณุจุงููุง"]},
                {q:"ุฃูู ููุนุจ ูุจุงุจูุ", a:["ุฑูุงู ูุฏุฑูุฏ", "ุงูุฑูุงู"]},
                {q:"ููุนุจ ุจุฑุดูููุฉุ", a:["ูุงูุจ ูู", "ููููุงูุจ"]},
                {q:"ููุจ ููุชุฎุจ ุงููุบุฑุจุ", a:["ุงุณูุฏ ุงูุงุทูุณ", "ุงููุบุฑุจ"]},
                {q:"ูู ูู ุงูุธุงูุฑุฉุ", a:["ุฑููุงูุฏู ุงูุจุฑุงุฒููู", "ูุงุฒุงุฑูู"]},
                {q:"ุจุทู ุงูู UCL 2024ุ", a:["ุฑูุงู ูุฏุฑูุฏ"]},
                {q:"ุฃุณุฑุน ูุงุนุจ ุญุงููุงุ", a:["ูุจุงุจู", "ููููุงู"]},
                {q:"ุนุฏุฏ ุชุจุฏููุงุช ุงููุงุชุดุ", a:["5", "ุฎูุณุฉ"]},
                {q:"ูููุน ููุนุจ ูุงุฑุงูุงูุงุ", a:["ุงูุจุฑุงุฒูู"]},
                {q:"ุจุทู ุงููุงู 2023ุ", a:["ุณุงุญู ุงูุนุงุฌ", "ููุช ุฏูููุงุฑ"]},
                {q:"ูุงุฆุฒ ูููุฏูุงู 2010ุ", a:["ุงุณุจุงููุง"]},
                {q:"ุฃูู ุณููุนุจ ููููุณููุณุ", a:["ุฑูุงู ูุฏุฑูุฏ"]},
                {q:"ุตุงุญุจ ุงููุงุถูุฉ ููููุ", a:["ุงูุดุฉ", "ููุดุฉ"]},
                {q:"ูุณุชุถูู ูููุฏูุงู 2026ุ", a:["ุงูุฑููุง", "ููุฏุง", "ุงูููุณูู"]}
            ],
            fawazir: [
                {q:"ุดูุก ูุทูุฑ ุจูุง ุฃุฌูุญุฉุ", a:["ุงูุฏุฎุงู", "ุฏุฎุงู"]},
                {q:"ูู ุฃุณูุงู ููุง ูุนุถุ", a:["ุงููุดุท", "ูุดุท"]},
                {q:"ุดูุก ููุชุจ ููุง ููุฑุฃุ", a:["ุงูููู", "ููู"]},
                {q:"ูุญูุธ ุงููุงุก ููู ูุซููุจุ", a:["ุงูุงุณููุฌ", "ุงุณููุฌ"]},
                {q:"ูุณูุน ุจูุง ุฃุฐู ููุชููู ุจูุง ูุณุงูุ", a:["ุงูุชููููู", "ุงููุงุชู"]},
                {q:"ูู ุฑุฃุณ ููุง ุนูู ููุ", a:["ุงูุฏุจูุณ", "ูุณูุงุฑ"]},
                {q:"ูููุง ุฒุงุฏ ููุตุ", a:["ุงูุนูุฑ", "ุนูุฑ"]},
                {q:"ูุง ูุจุฑุฏ ูู ุงูุซูุงุฌุฉุ", a:["ุงููููู", "ุดุทุฉ"]},
                {q:"ูุชุญุฑู ุญููู ููุง ุชุฑุงูุ", a:["ุงูููุงุก", "ุฑูุญ"]},
                {q:"ูู ุนูู ููุง ูุฑูุ", a:["ุงูุงุจุฑุฉ", "ุงุจุฑุฉ"]},
                {q:"ููุจู ูุฃูู ูุดุฑูุ", a:["ุงูุดูุนุฉ", "ุดูุนุฉ"]},
                {q:"ูู ุดูุฑ ููู 28 ูููุ", a:["ูู ุงูุดููุฑ", "12"]},
                {q:"ุชุฐุจุญู ูุชุจูู ุนูููุ", a:["ุงูุจุตู", "ุจุตู"]},
                {q:"ูููุฉ ุชุจุทู ูู ูุทููุง ุจูุงุ", a:["ุงูุตูุช", "ุณููุช"]},
                {q:"ูุณุชุฎุฏูู ุงููุงุณ ุฃูุซุฑ ูููุ", a:["ุงุณูู", "ุงูุงุณู"]},
                {q:"ูุฏู ุจูุง ุจููุชุ", a:["ุงูุฎุฑูุทุฉ", "ุฎุฑูุทุฉ"]},
                {q:"ูุง ููุดู ุฅูุง ุจุงูุถุฑุจุ", a:["ุงููุณูุงุฑ", "ูุณูุงุฑ"]},
                {q:"ููุฑุตู ููุง ุชุฑุงูุ", a:["ุงูุฌูุน", "ุงูุจุฑุฏ"]},
                {q:"ูู ุฃุฑุฌู ููุง ููุดูุ", a:["ุงููุฑุณู", "ุทุงููุฉ"]},
                {q:"ูุธูุฑ ูู ุงูููู ููุฎุชูู ูู ุงูููุงุฑุ", a:["ุงูููุฑ", "ูุฌูู"]}
            ],
            no_repeat: [
                {q:"ุงุฐูุฑ ูุงููุฉ ุตูููุฉ", a:["ุจุทูุฎ", "ูุงูุฌู", "ูุงูุฌุง", "ุนูุจ", "ุฎูุฎ"]},
                {q:"ูุงุฑูุฉ ููุจุงููุงุช", a:["ุงูููู", "ุณุงูุณููุฌ", "ุดุงููู", "ููุงูู"]},
                {q:"ุฏููุฉ ุฃูุฑูููุฉ", a:["ูุตุฑ", "ุงูุฌุฒุงุฆุฑ", "ุชููุณ", "ุงููุบุฑุจ", "ููุฌูุฑูุง"]},
                {q:"ูุงุฏู ุฃูุฑูุจู", a:["ุฑูุงู ูุฏุฑูุฏ", "ุจุฑุดูููุฉ", "ูููุฑุจูู", "ุจุงูุฑู"]},
                {q:"ุฎุถุงุฑ ุฃุฎุถุฑ", a:["ุฎูุงุฑ", "ุฎุณ", "ูููุฎูุฉ", "ุฌุฑุฌูุฑ"]},
                {q:"ุงุณู ูุจู", a:["ูุญูุฏ", "ููุณู", "ููุณู", "ุนูุณู"]},
                {q:"ุนุงุตูุฉ ุนุฑุจูุฉ", a:["ุงููุงูุฑุฉ", "ุงูุฑูุงุถ", "ุงููุฏุณ", "ุนูุงู"]},
                {q:"ูุงุนุจ ููุฑุฉ ุนุงููู", a:["ููุณู", "ุฑููุงูุฏู", "ุตูุงุญ", "ูููุงุฑ"]},
                {q:"ูููุจ ุณูุงุฑ", a:["ุงููุฑูุฎ", "ุงููุดุชุฑู", "ุงูุฒูุฑุฉ", "ุฒุญู"]},
                {q:"ูููู ูุฑุชูู", a:["ุชูู ูุฌูุฑู", "ุณุจููุฌ ุจูุจ", "ุณููุจุง", "ูููู"]},
                {q:"ุชุทุจูู ูุงุชู", a:["ูุงุชุณุงุจ", "ููุณุจูู", "ุชูู ุชูู", "ุงูุณุชุฌุฑุงู"]},
                {q:"ุญููุงู ุบุงุจุฉ", a:["ุงุณุฏ", "ููุฑ", "ููุฏ", "ุฐุฆุจ"]},
                {q:"ูุบุฉ ุจุฑูุฌุฉ", a:["ุจุงูุซูู", "ุฌุงูุง", "ุณู ุจูุณ", "ุฌุงูุง ุณูุฑูุจุช"]},
                {q:"ูุงุฏุฉ ุนูููุฉ", a:["ููุฒูุงุก", "ููููุงุก", "ุงุญูุงุก", "ุฑูุงุถูุงุช"]},
                {q:"ุนููุฉ", a:["ุฏููุงุฑ", "ุฌููู", "ููุฑู", "ุฑูุงู"]},
                {q:"ุตุญุงุจู", a:["ุนูู", "ุนูุฑ", "ุนุซูุงู", "ุงุจู ุจูุฑ"]},
                {q:"ููู", a:["ุงุญูุฑ", "ุงุฒุฑู", "ุงุฎุถุฑ", "ุงุตูุฑ"]},
                {q:"ูููุน ุชูุงุตู", a:["ููุณุจูู", "ุชููุชุฑ", "ููููุฏ ุงู", "ุฑูุฏูุช"]},
                {q:"ุนุถู ุจุงูุฌุณู", a:["ููุจ", "ุนูู", "ูุจุฏ", "ุฑุฆุฉ"]},
                {q:"ูุฏููุฉ ูุตุฑูุฉ", a:["ุงููุงูุฑุฉ", "ุงูุงุณููุฏุฑูุฉ", "ุงุณูุงู", "ุงูุงูุตุฑ"]}
            ],
            what_if: [
                {q:"ูู ูููุช ูุญูุธุฉุ", a:["ูุฑุฌุนูุง", "ุงุณูููุง", "ุงุฏูุฑ ุนูู ุตุงุญุจูุง"]},
                {q:"ูู ุจููุช ุฑุฆูุณุ", a:["ููุฒุน ูููุณ", "ูุจูู ูุฏุงุฑุณ"]},
                {q:"ูู ุชูุฏุฑ ุชุทูุฑุ", a:["ูุณุงูุฑ", "ูุทูุฑ ููู ุงูุจูุช"]},
                {q:"ูู ูุณุจุช ูููููุ", a:["ูุชุจุฑุน", "ูุดุชุฑู ุจูุช"]},
                {q:"ูู ุจููุช ุบูุฑ ูุฑุฆูุ", a:["ูุฏุฎู ุงูุณูููุง", "ูุฑุงูุจ ุงููุงุณ"]},
                {q:"ูู ุฑุฌุนุช ูููุงุถูุ", a:["ูุฐุงูุฑ", "ูุบูุฑ ูุฑุงุฑู"]},
                {q:"ูู ูุงุจูุช ุตูุงุญุ", a:["ูุชุตูุฑ", "ูุทูุจ ุชูุดุฑุช"]},
                {q:"ูู ุนุดุช ูู ุงููุฑูุฎุ", a:["ูุจูู ุฎููุฉ", "ูุฒุฑุน ุจุทุงุทุณ"]},
                {q:"ูู ุจููุช ูุฏูุฑุ", a:["ูุฑูุฏ ุงููุงุณ", "ูุฒูุฏ ุงููุฑุชุจุงุช"]},
                {q:"ูู ูุนุงู ูุตุจุงุญุ", a:["ูุทูุจ ูุงู", "ูุทูุจ ุตุญุฉ"]},
                {q:"ูู ุจููุช ูุฏุฑุจุ", a:["ูุงุฎุฏ ุงูุฏูุฑู", "ูุฌูุจ ูุนูุจุฉ"]},
                {q:"ูู ุบูุฑุช ุงุณููุ", a:["ูุณููู ุฑุนุฏ", "ูุณููู ุตูุฑ"]},
                {q:"ูู ูุนุงู ููุชุงุญุ", a:["ููุชุญ ุงูููุฒ", "ููุชุญ ูู ุงูุงุจูุงุจ"]},
                {q:"ูู ุจููุช ุฎุงุฑูุ", a:["ูุญูู ุงููุงุณ", "ูุทูุฑ"]},
                {q:"ูู ูููุช ุงูุญููุงูุ", a:["ูุตุงุญุจ ุงูุงุณุฏ", "ูููู ูุทุชู"]},
                {q:"ูู ุนุดุช ูุญุฏูุ", a:["ููุฑุฃ", "ููุงู ูุชูุฑ"]},
                {q:"ูู ุจููุช ุทุจุงุฎุ", a:["ูุนูู ุจูุชุฒุง", "ููุชุญ ูุทุนู"]},
                {q:"ูู ุณุงูุฑุช ูููุณุชูุจูุ", a:["ูุนุฑู ุญุธู", "ูุฌูุจ ุงุฎุชุฑุงุนุงุช"]},
                {q:"ูู ุจููุช ุทููุ", a:["ููุนุจ ุทูู ุงูููู", "ูุฑูุญ ุงูููุงูู"]},
                {q:"ูู ูุนุงู ุขูุฉ ุฒููุ", a:["ูุฑูุญ ุงููุฑุงุนูุฉ", "ูุบูุฑ ุงูุชุงุฑูุฎ"]}
            ]
        };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        window.setGame = (g) => {
            me.gameType = g;
            me.maxQ = parseInt(document.getElementById('q-count-select').value);
            showScreen('online-setup-screen');
        };

        window.initRoom = (type) => {
            me.name = document.getElementById('user-name').value.trim() || "ูุงุนุจ_" + Math.floor(Math.random()*99);
            me.room = type === 'create' ? Math.random().toString(36).substring(2,6).toUpperCase() : document.getElementById('join-input').value.toUpperCase();
            me.isHost = type === 'create';
            if(me.isHost) db.ref('party/' + me.room).set({ status: 'lobby', qIdx: 0, game: me.gameType, maxQ: me.maxQ });
            db.ref('party/' + me.room + '/players/' + me.name).set({ score: 0, submitted: false, lastAns: '' });
            listen(); showScreen('lobby-screen');
        };

        function listen() {
            db.ref('party/' + me.room).on('value', (snap) => {
                const data = snap.val(); if(!data) return;
                document.getElementById('room-display').innerText = "ููุฏ: " + me.room;
                
                let playersArr = Object.keys(data.players || {});
                let count = playersArr.length;
                let allSubmitted = playersArr.every(p => data.players[p].submitted);

                // ุชุญุฏูุซ ุงูููุจู ูุงูุนุฏุฏ
                let boardHTML = playersArr.map(p => `<p>๐ค ${p}: ${data.players[p].score}ู ${data.players[p].submitted ? 'โ' : 'โณ'}</p>`).join("");
                document.getElementById('players-list').innerHTML = boardHTML;

                if(me.isHost) {
                    const sBtn = document.getElementById('host-start-btn');
                    const isOk = count >= 2 && count <= 10;
                    sBtn.disabled = !isOk;
                    sBtn.style.opacity = isOk ? "1" : "0.5";
                    document.getElementById('lobby-msg').innerText = isOk ? "ุฌุงูุฒูู ููุงูุทูุงู!" : "ูุทููุจ 2 ูุงุนุจูู ุนูู ุงูุฃูู (ุญุงูููุง: "+count+")";
                }

                if(data.status === 'playing') {
                    showScreen('game-screen');
                    document.getElementById('input-zone').classList.remove('hidden');
                    document.getElementById('waiting-msg').classList.add('hidden');
                    const qData = dataBank[data.game][data.qIdx];
                    document.getElementById('question-text').innerText = qData ? qData.q : "ุงูุชูุช ุงูุฃุณุฆูุฉ";
                    document.getElementById('q-info').innerText = `ุณุคุงู ${data.qIdx + 1} ูู ${data.maxQ}`;
                    
                    if(allSubmitted && count > 0 && me.isHost) db.ref('party/' + me.room).update({ status: 'results' });
                } 
                else if(data.status === 'results') {
                    showScreen('result-screen');
                    const qData = dataBank[data.game][data.qIdx];
                    document.getElementById('correct-reveal').innerHTML = qData ? qData.a.map(a => `โข ${a}`).join("<br>") : "";
                    document.getElementById('leaderboard').innerHTML = boardHTML;
                    if(me.isHost) document.getElementById('host-controls').classList.remove('hidden');
                }
                if(me.isHost) document.getElementById('host-start-btn').classList.toggle('hidden', data.status !== 'lobby');
            });
        }

        window.submitProcess = () => {
            const val = document.getElementById('ans-input').value.trim();
            db.ref('party/' + me.room).once('value', s => {
                const data = s.val();
                const qData = dataBank[data.game][data.qIdx];
                let isCorrect = qData.a.some(ans => val.toLowerCase().includes(ans.toLowerCase()));
                if(isCorrect && val !== "") me.score += 10;
                db.ref('party/' + me.room + '/players/' + me.name).update({ score: me.score, submitted: true });
                document.getElementById('input-zone').classList.add('hidden');
                document.getElementById('waiting-msg').classList.remove('hidden');
                document.getElementById('ans-input').value = "";
            });
        };

        window.triggerStart = () => db.ref('party/' + me.room).update({ status: 'playing', qIdx: 0 });

        window.triggerNext = () => {
            db.ref('party/' + me.room).once('value', s => {
                const data = s.val();
                let next = data.qIdx + 1;
                if(next >= data.maxQ) { alert("ุงูุชูู ุงูุฌูู!"); location.reload(); return; }
                let updates = { status: 'playing', qIdx: next };
                for(let p in data.players) updates[`players/${p}/submitted`] = false;
                db.ref('party/' + me.room).update(updates);
            });
        };
    </script>
</body>
</html>
