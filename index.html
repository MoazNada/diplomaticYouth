<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIPLOMATIC HUB - ELITE</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="container">
        <h1 class="gold-text">DIPLOMATIC HUB</h1>

        <div id="category-screen" class="screen">
            <h3>Ø§Ø®ØªØ± Ø§Ù„ØªØ­Ø¯ÙŠ (10 Ø£Ø³Ø¦Ù„Ø©)</h3>
            <button class="game-card" onclick="selectGame('kora')">âš½ ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒÙˆØ±Ø©</button>
            <button class="game-card" onclick="selectGame('fawazir')">ğŸŒ™ ÙÙˆØ§Ø²ÙŠØ± Ø±Ù…Ø¶Ø§Ù†</button>
            <button class="game-card" onclick="selectGame('no_repeat')">ğŸš« Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±</button>
            <button class="game-card" onclick="selectGame('what_if')">ğŸ¤” Ù„Ùˆ ÙƒÙ†Øª Ù…ÙƒØ§Ù†Ùƒ</button>
        </div>

        <div id="login-screen" class="screen hidden">
            <input type="text" id="user-name" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±">
            <button class="action-btn" onclick="initParty('create')">â• Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</button>
            <input type="text" id="join-input" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
            <button class="game-card" onclick="initParty('join')">ğŸ”— Ø§Ù†Ø¶Ù…Ø§Ù…</button>
        </div>

        <div id="lobby-screen" class="screen hidden">
            <h2 id="room-code" class="gold-text"></h2>
            <div id="players-list" class="glass-box"></div>
            <button id="host-start-btn" class="action-btn hidden" onclick="startRound()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ ğŸš€</button>
        </div>

        <div id="game-screen" class="screen hidden">
            <div class="timer-wrapper"><div id="timer-bar"></div></div>
            <p id="q-counter" style="color:var(--gold);"></p>
            <div class="glass-box">
                <h3 id="question-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
            </div>
            <input type="text" id="ans-input" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§...">
            <button class="action-btn" id="send-btn" onclick="submitAnswer()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© âœ…</button>
            <p id="wait-msg" class="hidden">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø¥Ø¬Ø§Ø¨ØªÙƒ.. Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø¨Ø§Ù‚ÙŠ</p>
        </div>

        <div id="judge-screen" class="screen hidden">
            <h3 class="gold-text">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªØ­ÙƒÙŠÙ… âš–ï¸</h3>
            <div id="judging-list" class="glass-box"></div>
            <div class="glass-box" style="border-color: #00ff88;">
                <p>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©:</p>
                <h2 id="model-answer" style="color:#00ff88;"></h2>
            </div>
            <div id="host-nav" class="hidden">
                <button id="next-btn" class="action-btn" onclick="startRound()">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
                <button class="game-card" onclick="location.reload()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ </button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAESCjnKsQxNX_IKH9Fm_ePpIsbb9C_NsE",
            authDomain: "diplomatic-games.firebaseapp.com",
            projectId: "diplomatic-games",
            storageBucket: "diplomatic-games.firebasestorage.app",
            messagingSenderId: "726415224604",
            appId: "1:726415224604:web:3f436ef230254a5ee914d9",
            databaseURL: "https://diplomatic-games-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let me = { name: '', room: '', isHost: false, game: '', score: 0 };
        
        // Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (10 Ø£Ø³Ø¦Ù„Ø© Ù„ÙƒÙ„ Ù„Ø¹Ø¨Ø©)
        const questions = {
            kora: [
                {q: "Ù…Ù† Ù‡Ø¯Ø§Ù Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØŸ", a: "Ø±ÙˆÙ†Ø§Ù„Ø¯Ùˆ"}, {q: "Ù†Ø§Ø¯ÙŠ Ø§Ù„Ù‚Ø±Ù† ÙÙŠ Ø£ÙØ±ÙŠÙ‚ÙŠØ§ØŸ", a: "Ø§Ù„Ø§Ù‡Ù„ÙŠ"},
                {q: "Ù…Ù† ÙØ§Ø² Ø¨ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù… 2022ØŸ", a: "Ø§Ù„Ø§Ø±Ø¬Ù†ØªÙŠÙ†"}, {q: "Ø£ÙŠÙ† ÙŠÙ„Ø¹Ø¨ Ù‡Ø§Ù„Ø§Ù†Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹ØŸ", a: "Ù…Ø§Ù†Ø´Ø³ØªØ± Ø³ÙŠØªÙŠ"},
                {q: "Ø£ÙƒØ«Ø± Ù„Ø§Ø¹Ø¨ ÙØ§Ø² Ø¨Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©ØŸ", a: "Ù…ÙŠØ³ÙŠ"}, {q: "Ø¨Ø·Ù„ Ø¯ÙˆØ±ÙŠ Ø£Ø¨Ø·Ø§Ù„ Ø£ÙˆØ±ÙˆØ¨Ø§ 2024ØŸ", a: "Ø±ÙŠØ§Ù„ Ù…Ø¯Ø±ÙŠØ¯"},
                {q: "Ù„Ù‚Ø¨ Ù…Ù†ØªØ®Ø¨ Ù…ØµØ±ØŸ", a: "Ø§Ù„ÙØ±Ø§Ø¹Ù†Ø©"}, {q: "ÙÙŠ Ø£ÙŠ Ø¯ÙˆÙ„Ø© ÙŠÙ‚Ø¹ Ù…Ù„Ø¹Ø¨ Ù…Ø§Ø±Ø§ÙƒØ§Ù†Ø§ØŸ", a: "Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„"},
                {q: "ÙƒÙ… Ø¹Ø¯Ø¯ Ù„Ø§Ø¹Ø¨ÙŠ ÙØ±ÙŠÙ‚ ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…ØŸ", a: "11"}, {q: "Ù…Ø¯Ø±Ø¨ Ù…Ø§Ù†Ø´Ø³ØªØ± Ø³ÙŠØªÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØŸ", a: "ØºÙˆØ§Ø±Ø¯ÙŠÙˆÙ„Ø§"}
            ],
            fawazir: [
                {q: "Ø´ÙŠØ¡ ÙŠØ·ÙŠØ± Ø¨Ù„Ø§ Ø£Ø¬Ù†Ø­Ø©ØŸ", a: "Ø§Ù„Ø¯Ø®Ø§Ù†"}, {q: "ÙŠØ³Ù…Ø¹ Ø¨Ù„Ø§ Ø£Ø°Ù† ÙˆÙŠØªÙƒÙ„Ù… Ø¨Ù„Ø§ Ù„Ø³Ø§Ù†ØŸ", a: "Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†"},
                {q: "Ù„Ù‡ Ø£Ø³Ù†Ø§Ù† ÙˆÙ„Ø§ ÙŠØ¹Ø¶ØŸ", a: "Ø§Ù„Ù…Ø´Ø·"}, {q: "Ø¨ÙŠØª Ù„ÙŠØ³ Ù„Ù‡ Ø£Ø¨ÙˆØ§Ø¨ ÙˆÙ„Ø§ Ù†ÙˆØ§ÙØ°ØŸ", a: "Ø§Ù„Ù‚ØµÙŠØ¯Ø©"},
                {q: "ÙŠÙ…Ø´ÙŠ Ø¨Ù„Ø§ Ø£Ø±Ø¬Ù„ ÙˆÙŠØ¯Ø®Ù„ Ø§Ù„Ø£Ø°Ù†ÙŠÙ†ØŸ", a: "Ø§Ù„ØµÙˆØª"}, {q: "ÙƒÙ„Ù…Ø§ Ø£Ø®Ø°Øª Ù…Ù†Ù‡ ÙƒØ¨Ø±ØŸ", a: "Ø§Ù„Ø­ÙØ±Ø©"},
                {q: "Ù„Ù‡ Ø±Ø£Ø³ ÙˆÙ„Ø§ Ø¹ÙŠÙ† Ù„Ù‡ØŸ", a: "Ø§Ù„Ø¯Ø¨ÙˆØ³"}, {q: "Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ø«Ù‚ÙˆØ¨ ÙˆÙŠØ­ÙØ¸ Ø§Ù„Ù…Ø§Ø¡ØŸ", a: "Ø§Ù„Ø§Ø³ÙÙ†Ø¬"},
                {q: "ÙƒÙ… Ø´Ù‡Ø± ÙÙŠ Ø§Ù„Ø³Ù†Ø© ÙÙŠÙ‡ 28 ÙŠÙˆÙ…ØŸ", a: "ÙƒÙ„ Ø§Ù„Ø´Ù‡ÙˆØ±"}, {q: "Ø§Ø¨Ù† Ø£Ù…Ùƒ ÙˆØ£Ø¨ÙˆÙƒ ÙˆÙ„ÙŠØ³ Ø¨Ø£Ø®ÙŠÙƒØŸ", a: "Ø£Ù†Øª"}
            ]
        };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        window.selectGame = (g) => { me.game = g; showScreen('login-screen'); };

        window.initParty = (type) => {
            me.name = document.getElementById('user-name').value || "Ù„Ø§Ø¹Ø¨";
            me.room = type === 'create' ? Math.random().toString(36).substring(2,6).toUpperCase() : document.getElementById('join-input').value.toUpperCase();
            me.isHost = type === 'create';
            if(me.isHost) db.ref('games/'+me.room).set({status:'lobby', qIdx: 0, gameType: me.game, timer: 20});
            db.ref('games/'+me.room+'/players/'+me.name).set({score: 0, ans: '', submitted: false});
            listen();
            showScreen('lobby-screen');
        };

        function listen() {
            db.ref('games/'+me.room).on('value', (snap) => {
                const data = snap.val(); if(!data) return;
                document.getElementById('room-code').innerText = "ÙƒÙˆØ¯: " + me.room;
                
                const pList = document.getElementById('players-list');
                pList.innerHTML = "";
                for(let p in data.players) pList.innerHTML += `<p>ğŸ‘¤ ${p}: ${data.players[p].score} Ù†Ù‚Ø·Ø©</p>`;

                if(data.status === 'playing') {
                    showScreen('game-screen');
                    document.getElementById('ans-input').classList.remove('hidden');
                    document.getElementById('send-btn').classList.remove('hidden');
                    document.getElementById('wait-msg').classList.add('hidden');
                    document.getElementById('q-counter').innerText = `Ø³Ø¤Ø§Ù„ ${data.qIdx + 1} Ù…Ù† 10`;
                    document.getElementById('question-text').innerText = questions[data.gameType][data.qIdx].q;
                    document.getElementById('timer-bar').style.width = (data.timer / 20 * 100) + "%";
                } else if(data.status === 'judging') {
                    showScreen('judge-screen');
                    renderResults(data);
                }
                if(me.isHost) document.getElementById('host-start-btn').classList.toggle('hidden', data.status !== 'lobby');
            });
        }

        window.submitAnswer = () => {
            const ans = document.getElementById('ans-input').value.trim();
            db.ref('games/'+me.room+'/players/'+me.name).update({ans: ans, submitted: true});
            document.getElementById('ans-input').classList.add('hidden');
            document.getElementById('send-btn').classList.add('hidden');
            document.getElementById('wait-msg').classList.remove('hidden');
            document.getElementById('ans-input').value = "";
        };

        window.startRound = () => {
            db.ref('games/'+me.room).once('value', snap => {
                const qIdx = snap.val().status === 'judging' ? snap.val().qIdx + 1 : 0;
                if(qIdx >= 10) { alert("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠ! ØªÙÙ‚Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©."); return; }
                db.ref('games/'+me.room).update({status: 'playing', timer: 20, qIdx: qIdx});
                let t = 20;
                let i = setInterval(() => {
                    t--; db.ref('games/'+me.room).update({timer: t});
                    if(t <= 0) { clearInterval(i); db.ref('games/'+me.room).update({status: 'judging'}); }
                }, 1000);
            });
        };

        function renderResults(data) {
            const list = document.getElementById('judging-list');
            list.innerHTML = "<h4>Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø¨Ø·Ø§Ù„:</h4>";
            const correctAns = questions[data.gameType][data.qIdx].a;
            document.getElementById('model-answer').innerText = correctAns;

            for(let p in data.players) {
                const pAns = data.players[p].ans || "Ù„Ù… ÙŠØ¬Ø§ÙˆØ¨";
                const isCorrect = pAns.toLowerCase() === correctAns.toLowerCase();
                list.innerHTML += `
                    <div style="margin:10px 0; border-bottom:1px solid #333; padding:5px;">
                        <span style="${isCorrect ? 'color:#00ff88;' : ''}"><strong>${p}:</strong> ${pAns}</span>
                        ${me.isHost ? `<button onclick="addScore('${p}')" style="float:left; background:#28a745; color:white; border:none; padding:2px 8px; border-radius:5px;">ØµØ­ âœ…</button>` : ''}
                    </div>`;
            }
            document.getElementById('host-nav').classList.toggle('hidden', !me.isHost);
        }

        window.addScore = (p) => db.ref('games/'+me.room+'/players/'+p+'/score').transaction(s => (s||0)+10);
    </script>
</body>
</html>
