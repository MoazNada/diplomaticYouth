<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIPLOMATIC HUB - ELITE EDITION</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="container">
        <h1 class="gold-text">DIPLOMATIC HUB</h1>

        <div id="category-screen" class="screen">
            <h3>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù„Ø¹Ø¨Ø©</h3>
            <button class="game-card" onclick="setGame('kora')">âš½ ÙƒÙˆØ±Ø©</button>
            <button class="game-card" onclick="setGame('fawazir')">ğŸŒ™ ÙÙˆØ§Ø²ÙŠØ±</button>
            <button class="game-card" onclick="setGame('no_repeat')">ğŸš« Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø±</button>
            <button class="game-card" onclick="setGame('what_if')">ğŸ¤” Ù„Ùˆ ÙƒÙ†Øª Ù…ÙƒØ§Ù†Ùƒ</button>
            <div style="margin-top:20px;">
                <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</p>
                <select id="q-count-select" class="action-btn" style="background:#222; color:white;">
                    <option value="10">10 Ø£Ø³Ø¦Ù„Ø©</option>
                    <option value="20">20 Ø³Ø¤Ø§Ù„</option>
                </select>
            </div>
        </div>

        <div id="online-setup-screen" class="screen hidden">
            <input type="text" id="user-name" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±">
            <button class="action-btn" onclick="initRoom('create')">â• Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</button>
            <input type="text" id="join-input" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
            <button class="game-card" onclick="initRoom('join')">ğŸ”— Ø§Ù†Ø¶Ù…Ø§Ù…</button>
        </div>

        <div id="lobby-screen" class="screen hidden">
            <h2 id="room-display" class="gold-text"></h2>
            <div class="glass-box">
                <p>Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†:</p>
                <div id="players-list"></div>
            </div>
            <button id="host-start-btn" class="action-btn hidden" onclick="triggerStart(true)">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬ÙˆÙ„Ø©! ğŸš€</button>
        </div>

        <div id="game-screen" class="screen hidden">
            <div class="timer-wrapper"><div id="timer-bar"></div></div>
            <p id="q-info" style="color:var(--gold); font-weight:bold;"></p>
            <div class="glass-box">
                <h3 id="question-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
            </div>
            <div id="input-zone">
                <input type="text" id="ans-input" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§...">
                <button class="action-btn" onclick="submitAndCheck()">Ø¥Ø±Ø³Ø§Ù„ âœ…</button>
            </div>
            <div id="instant-feedback" class="hidden" style="font-size: 1.3rem; margin-top:15px; font-weight:bold;"></div>
        </div>

        <div id="result-screen" class="screen hidden">
            <h3 class="gold-text">Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø© ğŸ†</h3>
            <div id="leaderboard" class="glass-box"></div>
            <div class="glass-box" style="border: 1px solid #00ff88;">
                <p>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙƒØ§Ù†Øª:</p>
                <h2 id="correct-answer-reveal" style="color:#00ff88;"></h2>
            </div>
            <div id="host-controls" class="hidden">
                <button id="next-q-btn" class="action-btn" onclick="triggerStart(false)">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
                <button class="game-card" onclick="location.reload()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ </button>
            </div>
            <p id="guest-msg" class="hidden">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¶ÙŠÙ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ...</p>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAESCjnKsQxNX_IKH9Fm_ePpIsbb9C_NsE",
            authDomain: "diplomatic-games.firebaseapp.com",
            projectId: "diplomatic-games",
            storageBucket: "diplomatic-games.firebasestorage.app",
            messagingSenderId: "726415224604",
            appId: "1:726415224604:web:3f436ef230254a5ee914d9",
            databaseURL: "https://diplomatic-games-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let me = { name: '', room: '', isHost: false, game: '', score: 0, maxQ: 10 };
        
        const dataBank = {
            kora: [
                {q:"Ù…Ù† Ù‡Ø¯Ø§Ù Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØŸ", a:"Ø±ÙˆÙ†Ø§Ù„Ø¯"}, {q:"Ù†Ø§Ø¯ÙŠ Ø§Ù„Ù‚Ø±Ù† ÙÙŠ Ø£ÙØ±ÙŠÙ‚ÙŠØ§ØŸ", a:"Ø§Ù„Ø§Ù‡Ù„ÙŠ"},
                {q:"Ø¨Ø·Ù„ Ù…ÙˆÙ†Ø¯ÙŠØ§Ù„ 2022ØŸ", a:"Ø§Ù„Ø§Ø±Ø¬Ù†ØªÙŠÙ†"}, {q:"Ø£ÙŠÙ† ÙŠÙ„Ø¹Ø¨ Ù‡Ø§Ù„Ø§Ù†Ø¯ØŸ", a:"Ù…Ø§Ù†Ø´Ø³ØªØ± Ø³ÙŠØªÙŠ"},
                {q:"Ø£ÙƒØ«Ø± Ù„Ø§Ø¹Ø¨ ÙØ§Ø² Ø¨Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©ØŸ", a:"Ù…ÙŠØ³ÙŠ"}, {q:"Ø¨Ø·Ù„ Ø£Ø¨Ø·Ø§Ù„ Ø£ÙˆØ±ÙˆØ¨Ø§ 2024ØŸ", a:"Ø±ÙŠØ§Ù„ Ù…Ø¯Ø±ÙŠØ¯"},
                {q:"Ù„Ù‚Ø¨ Ù…Ù†ØªØ®Ø¨ Ù…ØµØ±ØŸ", a:"Ø§Ù„ÙØ±Ø§Ø¹Ù†Ø©"}, {q:"Ø¯ÙˆÙ„Ø© Ù…Ù„Ø¹Ø¨ Ù…Ø§Ø±Ø§ÙƒØ§Ù†Ø§ØŸ", a:"Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„"},
                {q:"Ø¹Ø¯Ø¯ Ù„Ø§Ø¹Ø¨ÙŠ ÙØ±ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ±Ø©ØŸ", a:"11"}, {q:"Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø³ÙŠØªÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠØŸ", a:"ØºÙˆØ§Ø±Ø¯ÙŠÙˆÙ„Ø§"},
                {q:"Ø£ÙŠÙ† Ø£Ù‚ÙŠÙ… Ø£ÙˆÙ„ ÙƒØ£Ø³ Ø¹Ø§Ù„Ù…ØŸ", a:"Ø§Ù„Ø§ÙˆØ±ÙˆØºÙˆØ§ÙŠ"}, {q:"Ù„ÙˆÙ† Ù‚Ù…ÙŠØµ Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ØŸ", a:"Ø§ØµÙØ±"},
                {q:"Ù…Ù„Ø¹Ø¨ Ù†Ø§Ø¯ÙŠ Ù„ÙŠÙØ±Ø¨ÙˆÙ„ØŸ", a:"Ø§Ù†ÙÙŠÙ„Ø¯"}, {q:"Ø¨Ø·Ù„ ÙŠÙˆØ±Ùˆ 2020ØŸ", a:"Ø§ÙŠØ·Ø§Ù„ÙŠØ§"},
                {q:"ÙƒÙ… Ø¹Ø¯Ø¯ Ø¨Ø·ÙˆÙ„Ø§Øª Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ ÙÙŠ Ø§Ù„Ù…ÙˆÙ†Ø¯ÙŠØ§Ù„ØŸ", a:"5"}, {q:"Ù„Ø§Ø¹Ø¨ Ù„Ù‚Ø¨ Ø¨Ø§Ù„Ø¸Ø§Ù‡Ø±Ø©ØŸ", a:"Ø±ÙˆÙ†Ø§Ù„Ø¯Ùˆ"},
                {q:"Ø£ÙŠÙ† ÙŠÙ„Ø¹Ø¨ Ù…Ø¨Ø§Ø¨ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹ØŸ", a:"Ø±ÙŠØ§Ù„ Ù…Ø¯Ø±ÙŠØ¯"}, {q:"Ù†Ø§Ø¯ÙŠ ÙŠÙ„Ù‚Ø¨ Ø¨Ø§Ù„Ø±ÙŠØ¯Ø²ØŸ", a:"Ù„ÙŠÙØ±Ø¨ÙˆÙ„"},
                {q:"Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø¬ÙˆÙ‡Ø±Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡ØŸ", a:"Ø¨ÙŠÙ„ÙŠÙ‡"}, {q:"Ø¨Ø·Ù„ Ø§Ù„Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ 2024ØŸ", a:"Ù…Ø§Ù†Ø´Ø³ØªØ± Ø³ÙŠØªÙŠ"}
            ],
            fawazir: [
                {q:"Ø´ÙŠØ¡ ÙŠØ·ÙŠØ± Ø¨Ù„Ø§ Ø£Ø¬Ù†Ø­Ø©ØŸ", a:"Ø§Ù„Ø¯Ø®Ø§Ù†"}, {q:"ÙŠØ³Ù…Ø¹ Ø¨Ù„Ø§ Ø£Ø°Ù†ØŸ", a:"Ø§Ù„ØªÙ„ÙŠÙÙˆÙ†"},
                {q:"Ù„Ù‡ Ø£Ø³Ù†Ø§Ù† ÙˆÙ„Ø§ ÙŠØ¹Ø¶ØŸ", a:"Ø§Ù„Ù…Ø´Ø·"}, {q:"Ø¨ÙŠØª Ø¨Ù„Ø§ Ø£Ø¨ÙˆØ§Ø¨ØŸ", a:"Ø§Ù„Ù‚ØµÙŠØ¯Ø©"},
                {q:"ÙŠÙ…Ø´ÙŠ Ø¨Ù„Ø§ Ø£Ø±Ø¬Ù„ØŸ", a:"Ø§Ù„ØµÙˆØª"}, {q:"ÙƒÙ„Ù…Ø§ Ø£Ø®Ø°Øª Ù…Ù†Ù‡ ÙƒØ¨Ø±ØŸ", a:"Ø§Ù„Ø­ÙØ±Ø©"},
                {q:"Ù„Ù‡ Ø±Ø£Ø³ ÙˆÙ„Ø§ Ø¹ÙŠÙ†ØŸ", a:"Ø§Ù„Ø¯Ø¨ÙˆØ³"}, {q:"Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ø«Ù‚ÙˆØ¨ ÙˆÙŠØ­ÙØ¸ Ø§Ù„Ù…Ø§Ø¡ØŸ", a:"Ø§Ù„Ø§Ø³ÙÙ†Ø¬"},
                {q:"Ø´Ù‡Ø± ÙÙŠÙ‡ 28 ÙŠÙˆÙ…ØŸ", a:"ÙƒÙ„ Ø§Ù„Ø´Ù‡ÙˆØ±"}, {q:"Ø§Ø¨Ù† Ø£Ù…Ùƒ ÙˆÙ„ÙŠØ³ Ø¨Ø£Ø®ÙŠÙƒØŸ", a:"Ø£Ù†Øª"},
                {q:"Ø£Ù‡ÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯ ÙˆØ£Ø¹Ø² Ù…ÙÙ‚ÙˆØ¯ØŸ", a:"Ø§Ù„Ù…Ø§Ø¡"}, {q:"ØªØ±Ø§Ù‡ ÙÙŠ Ø§Ù„Ù„ÙŠÙ„ ÙˆÙ„Ø§ ØªØ±Ø§Ù‡ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø±ØŸ", a:"Ø­Ø±Ù Ø§Ù„ÙŠØ§Ø¡"},
                {q:"Ø£Ø®Øª Ø®Ø§Ù„Ùƒ ÙˆÙ„ÙŠØ³Øª Ø®Ø§Ù„ØªÙƒØŸ", a:"Ø§Ù…Ùƒ"}, {q:"ÙŠØ³ÙŠØ± Ø¨Ù„Ø§ Ù‚Ø¯Ù…ÙŠÙ† ÙˆÙŠØ¨ÙƒÙŠ Ø¨Ù„Ø§ Ø¹ÙŠÙ†ÙŠÙ†ØŸ", a:"Ø§Ù„Ø³Ø­Ø§Ø¨"},
                {q:"ÙŠÙ‚Ø±ØµÙƒ ÙˆÙ„Ø§ ØªØ±Ø§Ù‡ØŸ", a:"Ø§Ù„Ø¬ÙˆØ¹"}, {q:"Ù„Ù‡ Ø£ÙˆØ±Ø§Ù‚ ÙˆÙ„ÙŠØ³ Ø´Ø¬Ø±Ø§Ù‹ØŸ", a:"Ø§Ù„ÙƒØªØ§Ø¨"},
                {q:"ÙŠÙ…Ø´ÙŠ ÙˆÙŠÙ‚Ù ÙˆÙ„ÙŠØ³ Ù„Ù‡ Ø£Ø±Ø¬Ù„ØŸ", a:"Ø§Ù„Ø³Ø§Ø¹Ø©"}, {q:"Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø°ÙŠ ÙŠØªÙƒÙ„Ù… ÙƒÙ„ Ù„ØºØ§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", a:"Ø§Ù„ØµØ¯Ù‰"},
                {q:"Ù‚Ù„Ø¨Ù‡ ÙŠØ£ÙƒÙ„ Ù‚Ø´Ø±Ù‡ØŸ", a:"Ø§Ù„Ø´Ù…Ø¹Ù‡"}, {q:"ÙŠØ³Ù‚Ø· Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø¡ ÙˆÙ„Ø§ ÙŠØºØ±Ù‚ØŸ", a:"Ø§Ù„Ù…Ø·Ø±"}
            ],
            no_repeat: [
                {q:"Ø§Ø°ÙƒØ± ÙØ§ÙƒÙ‡Ø© (Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„ØªÙƒØ±Ø§Ø±)", a:"ÙØ§ÙƒÙ‡Ø©"}, {q:"Ø§Ø°ÙƒØ± Ø¯ÙˆÙ„Ø© Ø¹Ø±Ø¨ÙŠØ©", a:"Ø¯ÙˆÙ„Ø©"},
                {q:"Ø§Ø°ÙƒØ± Ù„ÙˆÙ†", a:"Ù„ÙˆÙ†"}, {q:"Ø§Ø³Ù… ÙˆÙ„Ø¯ Ø¨Ø­Ø±Ù Ø§Ù„Ù…ÙŠÙ…", a:"Ø§Ø³Ù…"},
                {q:"Ø§Ø³Ù… Ø¨Ù†Øª Ø¨Ø­Ø±Ù Ø§Ù„Ø³ÙŠÙ†", a:"Ø§Ø³Ù…"}, {q:"Ù…Ø§Ø±ÙƒØ© Ø³ÙŠØ§Ø±Ø§Øª", a:"Ø³ÙŠØ§Ø±Ø©"},
                {q:"Ø­ÙŠÙˆØ§Ù† Ù…ÙØªØ±Ø³", a:"Ø­ÙŠÙˆØ§Ù†"}, {q:"Ø¹Ø§ØµÙ…Ø© Ø¯ÙˆÙ„Ø©", a:"Ø¹Ø§ØµÙ…Ø©"},
                {q:"Ø§Ø³Ù… Ù†Ø¨ÙŠ", a:"Ù†Ø¨ÙŠ"}, {q:"Ø¬Ù…Ø§Ø¯ Ø¨Ø­Ø±Ù Ø§Ù„Ø·Ø§Ø¡", a:"Ø¬Ù…Ø§Ø¯"},
                {q:"Ø®Ø¶Ø§Ø± Ø£Ø®Ø¶Ø±", a:"Ø®Ø¶Ø§Ø±"}, {q:"Ù†Ø§Ø¯ÙŠ Ø£ÙˆØ±ÙˆØ¨ÙŠ", a:"Ù†Ø§Ø¯ÙŠ"},
                {q:"Ø±ÙŠØ§Ø¶Ø© Ù…Ø´Ù‡ÙˆØ±Ø©", a:"Ø±ÙŠØ§Ø¶Ø©"}, {q:"Ù…Ø§Ø¯Ø© Ø¯Ø±Ø§Ø³ÙŠØ©", a:"Ù…Ø§Ø¯Ø©"},
                {q:"Ø£ÙƒÙ„Ø© Ù…ØµØ±ÙŠØ©", a:"Ø£ÙƒÙ„Ø©"}, {q:"ÙƒÙˆÙƒØ¨ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©", a:"ÙƒÙˆÙƒØ¨"},
                {q:"Ø¹Ø¶Ùˆ ÙÙŠ Ø¬Ø³Ù… Ø§Ù„Ø¥Ù†Ø³Ø§Ù†", a:"Ø¹Ø¶Ùˆ"}, {q:"Ø§Ø³Ù… Ø¨Ø­Ø±", a:"Ø¨Ø­Ø±"},
                {q:"Ø·Ø§Ø¦Ø±", a:"Ø·Ø§Ø¦Ø±"}, {q:"ØªØ®ØµØµ Ø¬Ø§Ù…Ø¹ÙŠ", a:"ØªØ®ØµØµ"}
            ],
            what_if: [
                {q:"Ù„Ùˆ Ù„Ù‚ÙŠØª Ù…Ø­ÙØ¸Ø© ÙÙŠÙ‡Ø§ Ù…Ù„ÙŠÙˆÙ† Ø¬Ù†ÙŠÙ‡ØŸ", a:"Ø±Ø£ÙŠÙƒ"}, {q:"Ù„Ùˆ Ø¨Ù‚ÙŠØª Ø±Ø¦ÙŠØ³ Ù„Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ØŸ", a:"Ø±Ø£ÙŠÙƒ"},
                {q:"Ù„Ùˆ ØµØ­ÙŠØª Ù„Ù‚ÙŠØª Ù†ÙØ³Ùƒ Ø¨ØªØ·ÙŠØ±ØŸ", a:"Ø±Ø£ÙŠÙƒ"}, {q:"Ù„Ùˆ Ù‚Ø§Ø¨Ù„Ùƒ ÙƒØ§Ø¦Ù† ÙØ¶Ø§Ø¦ÙŠØŸ", a:"Ø±Ø£ÙŠÙƒ"},
                {q:"Ù„Ùˆ Ø¨Ù‚ÙŠØª ØºÙŠØ± Ù…Ø±Ø¦ÙŠØŸ", a:"Ø±Ø£ÙŠÙƒ"}, {q:"Ù„Ùˆ Ù…Ø¹Ø§Ùƒ Ø¢Ù„Ø© Ø²Ù…Ù†ØŸ", a:"Ø±Ø£ÙŠÙƒ"},
                {q:"Ù„Ùˆ ØªÙ‚Ø¯Ø± ØªØ¹ÙŠØ´ ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡ØŸ", a:"Ø±Ø£ÙŠÙƒ"}, {q:"Ù„Ùˆ ÙØ²Øª Ø¨Ø¬Ø§Ø¦Ø²Ø© Ù†ÙˆØ¨Ù„ØŸ", a:"Ø±Ø£ÙŠÙƒ"},
                {q:"Ù„Ùˆ Ø¨Ù‚ÙŠØª Ø¨Ø·Ù„ Ø®Ø§Ø±Ù‚ØŸ", a:"Ø±Ø£ÙŠÙƒ"}, {q:"Ù„Ùˆ ØªÙ‚Ø¯Ø± ØªÙƒÙ„Ù… Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§ØªØŸ", a:"Ø±Ø£ÙŠÙƒ"},
                {q:"Ù„Ùˆ Ø¨Ù‚ÙŠØª ØºÙ†ÙŠ ÙØ¬Ø£Ø©ØŸ", a:"Ø±Ø£ÙŠÙƒ"}, {q:"Ù„Ùˆ ØªÙ‚Ø¯Ø± ØªØºÙŠØ± Ø­Ø§Ø¬Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", a:"Ø±Ø£ÙŠÙƒ"},
                {q:"Ù„Ùˆ Ø¨Ù‚ÙŠØª Ù…Ù…Ø«Ù„ Ù…Ø´Ù‡ÙˆØ±ØŸ", a:"Ø±Ø£ÙŠÙƒ"}, {q:"Ù„Ùˆ ØªÙ‚Ø¯Ø± ØªØ¹ÙŠØ´ ÙÙŠ Ø¹ØµØ± Ø§Ù„Ø¯ÙŠÙ†Ø§ØµÙˆØ±Ø§ØªØŸ", a:"Ø±Ø£ÙŠÙƒ"},
                {q:"Ù„Ùˆ Ø¨Ù‚ÙŠØª Ø­ÙƒÙŠÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ØŸ", a:"Ø±Ø£ÙŠÙƒ"}, {q:"Ù„Ùˆ ØªÙ‚Ø¯Ø± ØªØ®ØªØ±Ø¹ Ø­Ø§Ø¬Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŸ", a:"Ø±Ø£ÙŠÙƒ"},
                {q:"Ù„Ùˆ Ø¨Ù‚ÙŠØª ØµØ§Ø­Ø¨ Ø´Ø±ÙƒØ© Ø¬ÙˆØ¬Ù„ØŸ", a:"Ø±Ø£ÙŠÙƒ"}, {q:"Ù„Ùˆ Ø¨Ù‚ÙŠØª Ø±Ø§Ø¦Ø¯ ÙØ¶Ø§Ø¡ØŸ", a:"Ø±Ø£ÙŠÙƒ"},
                {q:"Ù„Ùˆ Ø¨Ù‚ÙŠØª Ù…Ø¯Ø±Ø¨ Ù…Ù†ØªØ®Ø¨ Ù…ØµØ±ØŸ", a:"Ø±Ø£ÙŠÙƒ"}, {q:"Ù„Ùˆ ØªÙ‚Ø¯Ø± ØªØ®ØªØ§Ø± Ù‚ÙˆØ© Ø®Ø§Ø±Ù‚Ø© ÙˆØ§Ø­Ø¯Ø©ØŸ", a:"Ø±Ø£ÙŠÙƒ"}
            ]
        };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        window.setGame = (g) => { me.game = g; me.maxQ = document.getElementById('q-count-select').value; showScreen('online-setup-screen'); };

        window.initRoom = (type) => {
            me.name = document.getElementById('user-name').value.trim() || "Ù„Ø§Ø¹Ø¨_" + Math.floor(Math.random()*99);
            me.room = type === 'create' ? Math.random().toString(36).substring(2,6).toUpperCase() : document.getElementById('join-input').value.toUpperCase();
            me.isHost = type === 'create';
            if(me.isHost) db.ref('hub/'+me.room).set({status:'lobby', qIdx: 0, game: me.game, maxQ: me.maxQ, timer: 15});
            db.ref('hub/'+me.room+'/players/'+me.name).set({score: 0, submitted: false});
            listen();
            showScreen('lobby-screen');
        };

        function listen() {
            db.ref('hub/'+me.room).on('value', snap => {
                const data = snap.val(); if(!data) return;
                document.getElementById('room-display').innerText = me.room;
                const pList = document.getElementById('players-list');
                const board = document.getElementById('leaderboard');
                pList.innerHTML = ""; board.innerHTML = "";
                let allDone = true;
                let playerCount = 0;
                for(let p in data.players) {
                    playerCount++;
                    pList.innerHTML += `<p>ğŸ‘¤ ${p}: ${data.players[p].score}</p>`;
                    board.innerHTML += `<div style="display:flex; justify-content:space-between; margin:5px 0; border-bottom:1px solid #333;"><span>${p}</span> <span>${data.players[p].score} Ù†Ù‚Ø·Ø©</span></div>`;
                    if(!data.players[p].submitted) allDone = false;
                }
                if(allDone && playerCount > 0 && data.status === 'playing' && me.isHost) db.ref('hub/'+me.room).update({status: 'results'});
                if(data.status === 'playing') {
                    showScreen('game-screen');
                    document.getElementById('input-zone').classList.remove('hidden');
                    document.getElementById('instant-feedback').classList.add('hidden');
                    document.getElementById('q-info').innerText = `Ø³Ø¤Ø§Ù„ ${data.qIdx+1} Ù…Ù† ${data.maxQ}`;
                    document.getElementById('question-text').innerText = dataBank[data.game][data.qIdx].q;
                    document.getElementById('timer-bar').style.width = (data.timer/15*100) + "%";
                } else if(data.status === 'results') {
                    showScreen('result-screen');
                    document.getElementById('correct-answer-reveal').innerText = dataBank[data.game][data.qIdx].a;
                    if(me.isHost) document.getElementById('host-controls').classList.remove('hidden');
                    document.getElementById('guest-msg').classList.toggle('hidden', me.isHost);
                }
                if(me.isHost) document.getElementById('host-start-btn').classList.toggle('hidden', data.status !== 'lobby');
            });
        }

        window.submitAndCheck = () => {
            const val = document.getElementById('ans-input').value.trim();
            db.ref('hub/'+me.room).once('value', s => {
                const correct = dataBank[s.val().game][s.val().qIdx].a;
                const fb = document.getElementById('instant-feedback');
                fb.classList.remove('hidden');
                
                // ØªØ­Ù‚Ù‚ Ø°ÙƒÙŠ Ø¨Ø³ÙŠØ· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
                if(val.toLowerCase() === correct.toLowerCase() || (s.val().game === 'what_if')) {
                    fb.innerHTML = "âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!"; fb.style.color = "#00ff88";
                    me.score += 10;
                    db.ref('hub/'+me.room+'/players/'+me.name).update({score: me.score});
                } else {
                    fb.innerHTML = `âŒ Ø®Ø·Ø£! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­: ${correct}`; fb.style.color = "#ff4444";
                }
                db.ref('hub/'+me.room+'/players/'+me.name).update({submitted: true});
                document.getElementById('input-zone').classList.add('hidden');
                document.getElementById('ans-input').value = "";
            });
        };

        window.triggerStart = (first) => {
            db.ref('hub/'+me.room).once('value', s => {
                let next = first ? 0 : s.val().qIdx + 1;
                if(next >= s.val().maxQ) { alert("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„! Ù…Ø¨Ø±ÙˆÙƒ Ù„Ù„ÙØ§Ø¦Ø²."); return; }
                for(let p in s.val().players) db.ref('hub/'+me.room+'/players/'+p).update({submitted: false});
                db.ref('hub/'+me.room).update({status: 'playing', qIdx: next, timer: 15});
                let t = 15;
                let i = setInterval(() => {
                    t--; db.ref('hub/'+me.room).update({timer: t});
                    if(t <= 0) { clearInterval(i); db.ref('hub/'+me.room).update({status: 'results'}); }
                }, 1000);
            });
        };
    </script>
</body>
</html>
