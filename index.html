<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIPLOMATIC HUB - PRO 80</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="container">
        <h1 class="gold-text">DIPLOMATIC HUB</h1>

        <div id="category-screen" class="screen">
            <h3>ุงุฎุชุฑ ููุน ุงูุชุญุฏู</h3>
            <button class="game-card" onclick="setGame('kora')">โฝ ููุฑุฉ (20 ุณุคุงู)</button>
            <button class="game-card" onclick="setGame('fawazir')">๐ ููุงุฒูุฑ (20 ุณุคุงู)</button>
            <button class="game-card" onclick="setGame('no_repeat')">๐ซ ุจุฏูู ุชูุฑุงุฑ (20 ุณุคุงู)</button>
            <button class="game-card" onclick="setGame('what_if')">๐ค ูู ููุช ููุงูู (20 ุณุคุงู)</button>
            <div style="margin-top:20px;">
                <p>ุญุฏุฏ ุนุฏุฏ ุงูุฃุณุฆูุฉ ููุฐุง ุงูุฌูู:</p>
                <select id="q-count-select" class="action-btn" style="background:#222; color:white;">
                    <option value="10">10 ุฃุณุฆูุฉ</option>
                    <option value="20" selected>20 ุณุคุงู</option>
                </select>
            </div>
        </div>

        <div id="online-setup-screen" class="screen hidden">
            <input type="text" id="user-name" placeholder="ุงุณูู ุงููุณุชุนุงุฑ">
            <button class="action-btn" onclick="initRoom('create')">โ ุฅูุดุงุก ุบุฑูุฉ</button>
            <input type="text" id="join-input" placeholder="ููุฏ ุงูุบุฑูุฉ">
            <button class="game-card" onclick="initRoom('join')">๐ ุงูุถูุงู</button>
            <button class="back-nav-btn" onclick="showScreen('category-screen')">๐ ุฑุฌูุน</button>
        </div>

        <div id="lobby-screen" class="screen hidden">
            <h1 id="room-display" class="gold-text" style="font-size: 3rem;"></h1>
            <div class="glass-box">
                <p>ุงูุฃุจุทุงู ุงููุชุตููู ุญุงููุงู:</p>
                <div id="players-list"></div>
            </div>
            <button id="host-start-btn" class="action-btn hidden" onclick="triggerStart()">ุงุจุฏุฃ ุงูููุงุฌูุฉ ๐</button>
        </div>

        <div id="game-screen" class="screen hidden">
            <div class="timer-wrapper"><div id="timer-bar"></div></div>
            <p id="q-info" style="color:var(--gold); font-weight:bold;"></p>
            <div class="glass-box">
                <h3 id="question-text">...</h3>
            </div>
            <div id="input-zone">
                <input type="text" id="ans-input" placeholder="ุงูุชุจ ุฅุฌุงุจุชู ุจุณุฑุนุฉ!">
                <button class="action-btn" onclick="submitProcess()">ุฅุฑุณุงู โ</button>
            </div>
            <div id="instant-feedback" class="hidden" style="font-size: 1.3rem; margin-top:15px; font-weight:bold;"></div>
        </div>

        <div id="result-screen" class="screen hidden">
            <h3 class="gold-text">ุชุฑุชูุจ ุงูุฃุจุทุงู ๐</h3>
            <div id="leaderboard" class="glass-box"></div>
            <div class="glass-box" style="border: 1px solid #00ff88;">
                <p>ุงูุฅุฌุงุจุฉ ุงููููุฐุฌูุฉ:</p>
                <h2 id="correct-reveal" style="color:#00ff88;"></h2>
            </div>
            <div id="host-controls" class="hidden">
                <button class="action-btn" onclick="triggerStart()">ุงูุณุคุงู ุงูุชุงูู โก๏ธ</button>
                <button class="game-card" onclick="location.reload()">๐ ุฅููุงุก ุงูุฌูู</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAESCjnKsQxNX_IKH9Fm_ePpIsbb9C_NsE",
            authDomain: "diplomatic-games.firebaseapp.com",
            projectId: "diplomatic-games",
            storageBucket: "diplomatic-games.firebasestorage.app",
            messagingSenderId: "726415224604",
            appId: "1:726415224604:web:3f436ef230254a5ee914d9",
            databaseURL: "https://diplomatic-games-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let me = { name: '', room: '', isHost: false, gameType: '', maxQ: 20, score: 0 };
        
        const dataBank = {
            kora: [
                {q:"ูู ูุฏุงู ุงูุนุงูู ุงูุชุงุฑูุฎูุ", a:"ุฑููุงูุฏู"}, {q:"ูุงุฏู ุงููุฑู ูู ุฃูุฑูููุงุ", a:"ุงูุงููู"}, {q:"ุจุทู ูููุฏูุงู 2022ุ", a:"ุงูุงุฑุฌูุชูู"}, {q:"ูุฏุฑุจ ุงูุณูุชู ุงูุญุงููุ", a:"ุบูุงุฑุฏูููุง"}, {q:"ุฃูุซุฑ ูุงุนุจ ูุงุฒ ุจุงูุจุงููู ุฏูุฑุ", a:"ููุณู"}, {q:"ุจุทู ููุฑู 2024ุ", a:"ุงุณุจุงููุง"}, {q:"ุฃูู ููุนุจ ูุจุงุจู ุญุงููุงูุ", a:"ุฑูุงู ูุฏุฑูุฏ"}, {q:"ููุนุจ ุจุฑุดูููุฉ ุงูุดููุฑุ", a:"ูุงูุจ ูู"}, {q:"ููุจ ููุชุฎุจ ุงููุบุฑุจุ", a:"ุงุณูุฏ ุงูุงุทูุณ"}, {q:"ูู ูู ุงูุธุงูุฑุฉุ", a:"ุฑููุงูุฏู ุงูุจุฑุงุฒููู"}, {q:"ูุงุฏู ููุนุจ ูู ูุญูุฏ ุตูุงุญุ", a:"ูููุฑุจูู"}, {q:"ุจุทู ุฏูุฑู ุงุจุทุงู ุงูุฑูุจุง 2024ุ", a:"ุฑูุงู ูุฏุฑูุฏ"}, {q:"ุฃุณุฑุน ูุงุนุจ ูู ุงูุนุงููุ", a:"ูุจุงุจู"}, {q:"ูู ุนุฏุฏ ุชุจุฏููุงุช ูุฑุฉ ุงููุฏูุ", a:"5"}, {q:"ุฃูู ููุน ููุนุจ ูุงุฑุงูุงูุงุ", a:"ุงูุจุฑุงุฒูู"}, {q:"ุจุทู ุงูุฑูููุง 2023ุ", a:"ุณุงุญู ุงูุนุงุฌ"}, {q:"ูู ูุงุฒ ุจูุฃุณ ุงูุนุงูู 2010ุ", a:"ุงุณุจุงููุง"}, {q:"ูู ุนุฏุฏ ูุฏุงูุนู ุฎุทุฉ 4-4-2ุ", a:"4"}, {q:"ุตุงุญุจ ูุฏู ุงููุงุถูุฉ ููููุ", a:"ุงูุดุฉ"}, {q:"ุฃูู ุณุชูุงู ูุฃุณ ุงูุนุงูู 2026ุ", a:"ุงูุฑููุง"}
            ],
            fawazir: [
                {q:"ุดูุก ูุทูุฑ ุจูุง ุฃุฌูุญุฉุ", a:"ุงูุฏุฎุงู"}, {q:"ูู ุฃุณูุงู ููุง ูุนุถุ", a:"ุงููุดุท"}, {q:"ุดูุก ููุชุจ ููุง ููุฑุฃุ", a:"ุงูููู"}, {q:"ูููุก ุจุงูุซููุจ ููุญูุธ ุงููุงุกุ", a:"ุงูุงุณููุฌ"}, {q:"ุงุจู ุฃูู ูุฃุจูู ูููุณ ุฃุฎุงูุ", a:"ุงูุช"}, {q:"ููุดู ุจูุง ุฃุฑุฌู ููุฏุฎู ุงูุฃุฐูููุ", a:"ุงูุตูุช"}, {q:"ูู ุฑุฃุณ ููุง ุนูู ููุ", a:"ุงูุฏุจูุณ"}, {q:"ูููุง ุฒุงุฏ ููุตุ", a:"ุงูุนูุฑ"}, {q:"ูุง ูู ุงูุดูุก ุงูุฐู ูุง ูุจุฑุฏ ูู ุงูุซูุงุฌุฉุ", a:"ุงููููู"}, {q:"ูุชุญุฑู ุญููู ููุง ุชุฑุงูุ", a:"ุงูููุงุก"}, {q:"ูุง ูู ุงูุดูุก ุงูุฐู ูู ุนูู ููุง ูุฑูุ", a:"ุงูุงุจุฑุฉ"}, {q:"ููุจู ูุฃูู ูุดุฑูุ", a:"ุงูุดูุนุฉ"}, {q:"ูุณูุน ุจูุง ุฃุฐู ููุชููู ุจูุง ูุณุงูุ", a:"ุงูุชููููู"}, {q:"ูู ุดูุฑ ูู ุงูุณูุฉ ููู 28 ูููุ", a:"ูู ุงูุดููุฑ"}, {q:"ุดูุก ุชุฐุจุญู ูุชุจูู ุนูููุ", a:"ุงูุจุตู"}, {q:"ูุง ูู ุงููููุฉ ุงูุชู ุชุจุทู ุฅุฐุง ูุทููุง ุจูุงุ", a:"ุงูุตูุช"}, {q:"ุดูุก ูููู ููุณุชุฎุฏูู ุงููุงุณ ุฃูุซุฑ ูููุ", a:"ุงุณูู"}, {q:"ูุง ูู ุงูุดูุก ุงูุฐู ูุญูู ูุฏูุงู ุจูุง ุจููุชุ", a:"ุงูุฎุฑูุทุฉ"}, {q:"ูุง ูู ุงูุดูุก ุงูุฐู ูุง ููุดู ุฅูุง ุจุงูุถุฑุจุ", a:"ุงููุณูุงุฑ"}, {q:"ุดูุก ููุฑุตู ููุง ุชุฑุงูุ", a:"ุงูุฌูุน"}
            ],
            no_repeat: [
                {q:"ุงุฐูุฑ ุงุณู ูุงููุฉ ุญูุฑุงุก", a:"ุชูุงุญ"}, {q:"ุงุฐูุฑ ูุงุฑูุฉ ุณูุงุฑุงุช", a:"ุจู ุงู"}, {q:"ุงุฐูุฑ ุฏููุฉ ุฃูุฑูุจูุฉ", a:"ูุฑูุณุง"}, {q:"ุงุณู ูุงุฏู ูุตุฑู", a:"ุงูุฒูุงูู"}, {q:"ุงุฐูุฑ ุฎุถุงุฑ ุฃุฎุถุฑ", a:"ุฎูุงุฑ"}, {q:"ุงุณู ูุจู ุฐูุฑ ูู ุงููุฑุขู", a:"ูุญูุฏ"}, {q:"ุงุฐูุฑ ุนุงุตูุฉ ุนุฑุจูุฉ", a:"ุงููุงูุฑุฉ"}, {q:"ุงุณู ูุงุนุจ ููุฑุฉ ูุนุชุฒู", a:"ุฒูุฏุงู"}, {q:"ุงุฐูุฑ ูููุจ ูู ุงููุฌููุนุฉ ุงูุดูุณูุฉ", a:"ุงููุฑูุฎ"}, {q:"ุงุณู ูููู ูุตุฑู ุดููุฑ", a:"ุงููุงุธุฑ"}, {q:"ุงุฐูุฑ ุชุทุจูู ุชูุงุตู ุงุฌุชูุงุนู", a:"ููุณุจูู"}, {q:"ุงุณู ุญููุงู ููุชุฑุณ", a:"ุงุณุฏ"}, {q:"ุงุฐูุฑ ูุบุฉ ุนุงูููุฉ", a:"ุงูุนุฑุจูุฉ"}, {q:"ุงุณู ูุงุฏุฉ ุฏุฑุงุณูุฉ", a:"ุฑูุงุถูุงุช"}, {q:"ุงุฐูุฑ ุนููุฉ ุนุงูููุฉ", a:"ุฏููุงุฑ"}, {q:"ุงุณู ุตุญุงุจู ุฌููู", a:"ุงุจู ุจูุฑ"}, {q:"ุงุฐูุฑ ููู ูู ุฃููุงู ููุณ ูุฒุญ", a:"ุงุญูุฑ"}, {q:"ุงุณู ููุงุฉ ููุชููุจ", a:"ุฏุญูุญ"}, {q:"ุงุฐูุฑ ุฌุฒุก ูู ุฌุณู ุงูุฅูุณุงู", a:"ููุจ"}, {q:"ุงุณู ูุฏููุฉ ุณุงุญููุฉ", a:"ุงุณููุฏุฑูุฉ"}
            ],
            what_if: [
                {q:"ูู ููุช ููุงูู ููููุช ูุญูุธุฉุ", a:"ูุฑุฌุนูุง"}, {q:"ูู ุจููุช ุฑุฆูุณ ูุงุฏู ุจูุฑูุ", a:"ูุดุชุฑู ููุณู"}, {q:"ูู ุชูุฏุฑ ุชุทูุฑ ููู ูุงุญุฏุ", a:"ูุณุงูุฑ ุจุงุฑูุณ"}, {q:"ูู ูุณุจุช ููููู ุฌูููุ", a:"ูุชุตุฏู ุจููู"}, {q:"ูู ุจููุช ุบูุฑ ูุฑุฆูุ", a:"ูุฏุฎู ุงูุจูู"}, {q:"ูู ุฑุฌุนุช ุจุงูุฒููุ", a:"ูุตูุญ ุบูุทุงุชู"}, {q:"ูู ูุงุจูุช ูุฑูุณุชูุงููุ", a:"ูุชุตูุฑ ูุนุงู"}, {q:"ูู ุชูุฏุฑ ุชุนูุด ูู ุงููุถุงุกุ", a:"ูุฑูุญ ุงููุฑูุฎ"}, {q:"ูู ุจููุช ูุฏูุฑ ูุฏุฑุณุชูุ", a:"ูุบูู ุงูุทูุงุจ"}, {q:"ูู ูููุช ูุตุจุงุญ ุนูุงุก ุงูุฏููุ", a:"ูุทูุจ ุซุฑูุฉ"}, {q:"ูู ุจููุช ูุฏุฑุจ ููุชุฎุจ ูุตุฑุ", a:"ูุงุฎุฏ ุงูุฑูููุง"}, {q:"ูู ุชูุฏุฑ ุชุบูุฑ ุงุณููุ", a:"ูุณููู ุตูุฑ"}, {q:"ูู ูุนุงู ููุชุงุญ ูู ุงูุฃุจูุงุจุ", a:"ููุชุญ ูู ุงูุงุณุฑุงุฑ"}, {q:"ูู ุจููุช ุจุทู ุฎุงุฑูุ", a:"ูุญูู ุงููุงุณ"}, {q:"ูู ุชูุฏุฑ ุชุชููู ูุน ุงูุญููุงูุงุชุ", a:"ูุณุฃู ุงูุงุณุฏ"}, {q:"ูู ุนุดุช ูู ุฌุฒูุฑุฉ ููุญุฏูุ", a:"ูุตุทุงุฏ ุณูู"}, {q:"ูู ุจููุช ุทุจุงุฎ ุนุงูููุ", a:"ูุนูู ุจูุชุฒุง"}, {q:"ูู ุชูุฏุฑ ุชุณุงูุฑ ูููุณุชูุจูุ", a:"ูุนุฑู ุญุธู"}, {q:"ูู ุจููุช ุฃุตุบุฑ ุดุฎุต ูู ุงูุนุงููุ", a:"ููุนุจ ุทูู ุงูููู"}, {q:"ูู ูุนุงู ุขูุฉ ุฒููุ", a:"ูุฑูุญ ุนุตุฑ ุงููุฑุงุนูุฉ"}
            ]
        };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        window.setGame = (g) => {
            me.gameType = g;
            me.maxQ = parseInt(document.getElementById('q-count-select').value);
            showScreen('online-setup-screen');
        };

        window.initRoom = (type) => {
            me.name = document.getElementById('user-name').value.trim() || "ูุงุนุจ_" + Math.floor(Math.random()*99);
            me.room = type === 'create' ? Math.random().toString(36).substring(2,6).toUpperCase() : document.getElementById('join-input').value.toUpperCase();
            me.isHost = type === 'create';

            if(me.isHost) {
                db.ref('party/' + me.room).set({ status: 'lobby', qIdx: 0, game: me.gameType, maxQ: me.maxQ, timer: 15 });
            }
            db.ref('party/' + me.room + '/players/' + me.name).set({ score: 0, submitted: false });
            listen();
            showScreen('lobby-screen');
        };

        function listen() {
            db.ref('party/' + me.room).on('value', (snap) => {
                const data = snap.val(); if(!data) return;
                document.getElementById('room-display').innerText = me.room;
                const pList = document.getElementById('players-list');
                const board = document.getElementById('leaderboard');
                pList.innerHTML = ""; board.innerHTML = "";
                let allDone = true; let count = 0;

                for(let p in data.players) {
                    count++;
                    pList.innerHTML += `<p>๐ค ${p}: ${data.players[p].score}</p>`;
                    board.innerHTML += `<p style="display:flex; justify-content:space-between; border-bottom:1px solid #222;"><span>${p}</span><span>${data.players[p].score}ู</span></p>`;
                    if(!data.players[p].submitted) allDone = false;
                }

                if(allDone && count > 0 && data.status === 'playing' && me.isHost) {
                    db.ref('party/' + me.room).update({ status: 'results' });
                }

                if(data.status === 'playing') {
                    showScreen('game-screen');
                    document.getElementById('input-zone').classList.remove('hidden');
                    document.getElementById('instant-feedback').classList.add('hidden');
                    document.getElementById('q-info').innerText = `ุณุคุงู ${data.qIdx + 1} ูู ${data.maxQ}`;
                    document.getElementById('question-text').innerText = dataBank[data.game][data.qIdx]?.q || "ุงูุชูู ุงูุฌูู!";
                    document.getElementById('timer-bar').style.width = (data.timer / 15 * 100) + "%";
                } else if(data.status === 'results') {
                    showScreen('result-screen');
                    document.getElementById('correct-reveal').innerText = dataBank[data.game][data.qIdx]?.a || "--";
                    document.getElementById('host-controls').classList.toggle('hidden', !me.isHost);
                }
                if(me.isHost) document.getElementById('host-start-btn').classList.toggle('hidden', data.status !== 'lobby');
            });
        }

        window.submitProcess = () => {
            const val = document.getElementById('ans-input').value.trim();
            db.ref('party/' + me.room).once('value', s => {
                const correct = dataBank[s.val().game][s.val().qIdx].a;
                const feedback = document.getElementById('instant-feedback');
                feedback.classList.remove('hidden');

                if(val.toLowerCase() === correct.toLowerCase()) {
                    feedback.innerHTML = "โ ุตุญ!"; feedback.style.color = "#00ff88";
                    me.score += 10;
                } else {
                    feedback.innerHTML = `โ ุบูุท! ุงูุตุญ: ${correct}`; feedback.style.color = "#ff4444";
                }
                db.ref('party/' + me.room + '/players/' + me.name).update({ score: me.score, submitted: true });
                document.getElementById('input-zone').classList.add('hidden');
                document.getElementById('ans-input').value = "";
            });
        };

        window.triggerStart = () => {
            db.ref('party/' + me.room).once('value', s => {
                let idx = s.val().status === 'results' ? s.val().qIdx + 1 : 0;
                if(idx >= s.val().maxQ) { alert("ุงูุชูู ุงูุชุญุฏู!"); location.reload(); return; }
                
                for(let p in s.val().players) db.ref('party/'+me.room+'/players/'+p).update({submitted: false});
                db.ref('party/' + me.room).update({ status: 'playing', qIdx: idx, timer: 15 });
                
                let t = 15;
                let i = setInterval(() => {
                    t--; db.ref('party/' + me.room).update({ timer: t });
                    if(t <= 0) { clearInterval(i); db.ref('party/' + me.room).update({ status: 'results' }); }
                }, 1000);
            });
        };
    </script>
</body>
</html>
