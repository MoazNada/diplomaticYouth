<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIPLOMATIC HUB - PARTY</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="container">
        <h1 class="gold-text">DIPLOMATIC HUB</h1>

        <div id="connection-screen" class="screen">
            <button class="game-card" onclick="nav('online-lobby')">ğŸŒ Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</button>
            <button class="game-card" onclick="nav('online-lobby')">ğŸ”— Ø¯Ø®ÙˆÙ„ Ø¨Ø±Ù…Ø²</button>
        </div>

        <div id="online-lobby" class="screen hidden">
            <input type="text" id="player-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§">
            <button class="action-btn" onclick="makeRoom()">â• Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <div style="margin:15px 0;">Ø£Ùˆ</div>
            <input type="text" id="room-input" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
            <button class="game-card" onclick="enterRoom()">Ø¯Ø®ÙˆÙ„</button>
        </div>

        <div id="lobby-screen" class="screen hidden">
            <h3 class="gold-text" id="room-display"></h3>
            <p>Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†:</p>
            <ul id="players-list" style="list-style:none; padding:0;"></ul>
            <button id="start-game-btn" class="action-btn hidden" onclick="pickGame('kora')">Ø§Ø¨Ø¯Ø£ ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒÙˆØ±Ø© âš½</button>
        </div>

        <div id="game-screen" class="screen hidden">
            <div id="timer-bar" style="background:var(--gold); height:5px; width:100%;"></div>
            <p id="question-text" class="glass-box" style="font-size:1.5rem;"></p>
            
            <div id="answer-area">
                <input type="text" id="answer-input" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§..." oninput="checkAnswer()">
                <p id="feedback" style="margin-top:10px;"></p>
            </div>

            <div id="leaderboard" class="glass-box" style="margin-top:20px;">
                <h4>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­ÙŠØ© ğŸ†</h4>
                <div id="scores-display"></div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAESCjnKsQxNX_IKH9Fm_ePpIsbb9C_NsE",
            authDomain: "diplomatic-games.firebaseapp.com",
            projectId: "diplomatic-games",
            storageBucket: "diplomatic-games.firebasestorage.app",
            messagingSenderId: "726415224604",
            appId: "1:726415224604:web:3f436ef230254a5ee914d9",
            databaseURL: "https://diplomatic-games-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let myData = { name: '', room: '', isHost: false, score: 0 };
        const questions = {
            kora: [{q:"Ù…Ù† Ù‡Ùˆ Ù‡Ø¯Ø§Ù Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØŸ", a:"Ø±ÙˆÙ†Ø§Ù„Ø¯Ùˆ"}, {q:"Ù†Ø§Ø¯ÙŠ Ø§Ù„Ù‚Ø±Ù† ÙÙŠ Ø£ÙØ±ÙŠÙ‚ÙŠØ§ØŸ", a:"Ø§Ù„Ø§Ù‡Ù„ÙŠ"}]
        };

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        window.makeRoom = () => {
            const rId = Math.random().toString(36).substring(2, 6).toUpperCase();
            myData.name = document.getElementById('player-name').value || "Ù„Ø§Ø¹Ø¨ 1";
            myData.room = rId;
            myData.isHost = true;
            
            db.ref('party/' + rId).set({
                status: 'waiting',
                questionIdx: 0,
                players: { [myData.name]: 0 }
            }).then(() => {
                listenToParty(rId);
                nav('lobby-screen');
                document.getElementById('start-game-btn').classList.remove('hidden');
            });
        };

        window.enterRoom = () => {
            const rId = document.getElementById('room-input').value.toUpperCase().trim();
            myData.name = document.getElementById('player-name').value || "Ù„Ø§Ø¹Ø¨ Ø¬Ø¯ÙŠØ¯";
            myData.room = rId;
            
            db.ref('party/' + rId + '/players/' + myData.name).set(0).then(() => {
                listenToParty(rId);
                nav('lobby-screen');
            });
        };

        function listenToParty(rId) {
            document.getElementById('room-display').innerText = "ØºØ±ÙØ©: " + rId;
            db.ref('party/' + rId).on('value', (snap) => {
                const data = snap.val();
                if(!data) return;

                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬
                const list = document.getElementById('players-list');
                const scoreDiv = document.getElementById('scores-display');
                list.innerHTML = ""; scoreDiv.innerHTML = "";
                
                for(let p in data.players) {
                    list.innerHTML += `<li>âœ… ${p}</li>`;
                    scoreDiv.innerHTML += `<p>${p}: ${data.players[p]} Ù†Ù‚Ø·Ø©</p>`;
                }

                if(data.status === 'playing') {
                    nav('game-screen');
                    const q = questions.kora[data.questionIdx];
                    document.getElementById('question-text').innerText = q.q;
                    myData.currentAns = q.a;
                }
            });
        }

        window.pickGame = (type) => {
            db.ref('party/' + myData.room).update({ status: 'playing', questionIdx: 0 });
        };

        window.checkAnswer = () => {
            const val = document.getElementById('answer-input').value.trim();
            if(val === myData.currentAns) {
                myData.score += 10;
                document.getElementById('answer-input').value = "";
                document.getElementById('feedback').innerText = "ØµØ­! ğŸ‰";
                db.ref('party/' + myData.room + '/players/' + myData.name).set(myData.score);
                // Ø§Ù„Ù…Ø¶ÙŠÙ ÙŠÙ†Ù‚Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù„ÙŠ Ø¨Ø¹Ø¯Ù‡ Ù„Ùˆ ÙƒÙ„Ù‡ Ø¬Ø§ÙˆØ¨
                if(myData.isHost) {
                    setTimeout(() => {
                        db.ref('party/' + myData.room).update({ questionIdx: 1 });
                    }, 2000);
                }
            }
        };
    </script>
</body>
</html>
